<% layout('./../layout/admin') -%>
<div class="row">
    <div class="col-sm-3">
        <div id="download_waiting">Please wait some minutes .....</div>
        <div id="download_success" style="display:none;" >Download file completed. Thank you!!!</div>        
    </div>
    <a href ="<%=returnUrl%>"><span class="fa fa-arrow-left"></span> Return</a>
</div>

<script>
 

setTimeout(function() {
        var url_check_file = '<%=baseUrl%>/adminpanel/base/check-status-file-download?p=' + '<%=downloadPath%>';
        $.get(url_check_file, function(data){
            if(data.status === 'success'){
                var url = '<%=staticUrl%>medias/export/<%=downloadPath%>';
                downloadFile(url);
            }    
            else{
                var content = 'Please wait ' + data.time + ' minutes .....';
                $('#download_waiting').html();
            }
        },'JSON');           
    }, 6000);
 
 
    window.downloadFile = function (sUrl) {     
        document.getElementById("download_waiting").style.display = "none";
        document.getElementById("download_success").style.display = "block";
     
     //iOS devices do not support downloading. We have to inform user about this.
     if (/(iP)/g.test(navigator.userAgent)) {
        //alert('Your device does not support files downloading. Please try again in desktop browser.');
        window.open(sUrl, '_blank');
        return false;
     }
 
     //If in Chrome or Safari - download via virtual link click
     if (window.downloadFile.isChrome || window.downloadFile.isSafari) {
         //Creating new link node.
         var link = document.createElement('a');
         link.href = sUrl;
         link.setAttribute('target','_blank');
 
         if (link.download !== undefined) {
             //Set HTML5 download attribute. This will prevent file from opening if supported.
             var fileName = sUrl.substring(sUrl.lastIndexOf('/') + 1, sUrl.length);
             link.download = fileName;
         }
 
         //Dispatching click event.
         if (document.createEvent) {
             var e = document.createEvent('MouseEvents');
             e.initEvent('click', true, true);
             link.dispatchEvent(e);
             return true;
         }
     }
 
     // Force file download (whether supported by server).
     if (sUrl.indexOf('?') === -1) {
         sUrl += '?download';
     }
 
     window.open(sUrl, '_blank');
     return true;
    }
 
    window.downloadFile.isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
    window.downloadFile.isSafari = navigator.userAgent.toLowerCase().indexOf('safari') > -1;

</script>